import pandas as pd
import numpy as np

# Step 1.1: Load the dataset
file_path = "/mnt/data/nse_all_stock_data (1).csv"
df = pd.read_csv(file_path)

# Step 1.2: Basic overview
print("Shape of dataset (rows, columns):")
print(df.shape)

print("\nColumn names:")
print(df.columns.tolist())

print("\nData types:")
print(df.dtypes)

print("\nFirst 5 rows:")
print(df.head())

print("\nLast 5 rows:")
print(df.tail())

# Standardize column names
df.columns = (
    df.columns
    .str.strip()
    .str.lower()
    .str.replace(" ", "_")
    .str.replace(r"[^a-z0-9_]", "", regex=True)
)

print("Cleaned column names:")
print(df.columns.tolist())
# Missing values check
missing = df.isnull().sum().sort_values(ascending=False)
missing_percentage = (missing / len(df)) * 100

missing_df = pd.DataFrame({
    "missing_count": missing,
    "missing_percentage": missing_percentage
})

print(missing_df[missing_df["missing_count"] > 0])
# Convert numeric columns
numeric_keywords = ["open", "high", "low", "close", "price", "volume"]

for col in df.columns:
    if any(keyword in col for keyword in numeric_keywords):
        df[col] = pd.to_numeric(df[col], errors="coerce")

# Convert date column (auto-detect)
for col in df.columns:
    if "date" in col:
        df[col] = pd.to_datetime(df[col], errors="coerce")
print("\nUpdated data types:")
print(df.dtypes)

print("\nRemaining missing values:")
print(df.isnull().sum().sum())
